---
title: "Microbial Competition & Tree Adaptations"
subtitle: "Replicating and Extending Jiang et al. (Nature, 2024)"
author: ok bro
date: today
format: 
  html:
    theme: journal
    toc: true
    code-fold: true
    embed-resources: true
---

```{r}
#| include: false
#| warning: false
#| message: false
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(lme4)
library(lmerTest)
library(patchwork)
library(knitr)
library(kableExtra)

# Helper function
stats_table <- function(model, title) {
  res <- anova(model)
  kable(res, caption=title, digits=3) %>% kable_styling(full_width=F)
}
```

## 1. Introduction & Objectives

Elevated eCO2 is expected to increase forest growth. However, Jiang et al. (2024) showed that in P-limited soils, growth stagnates because microbes "pre-empt" (steal) the phosphorus.

**Our Objective:**\
Is the forest truly passive? We replicate the "stagnation" finding but extend the analysis to test for **Functional Plasticity** - the ability of trees to adapt their physiology (efficiency and rooting) even if biomass doesn't appear to change.

## 2. Replication Phase: The Problem

We first confirm the paper's mechanism using 2013-2016 data.

```{r}
df <- read_csv("data/master_data.csv")

# A. Inventory
pool_stats <- df %>% group_by(Trt) %>% 
  summarise(Micro=mean(Micro_P, na.rm=T), Soil=mean(Soil_P, na.rm=T))

# Graph 1: The Microbial Lockout
df %>% pivot_longer(c(Soil_P, Micro_P), names_to="Pool", values_to="Val") %>%
  ggplot(aes(x=Pool, y=Val, fill=Trt)) +
  stat_summary(fun=mean, geom="bar", position="dodge") +
  stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(0.9), width=0.2) +
  labs(title="Mechanism: Microbial Pre-emption", y="g P / m2") +
  theme_classic() + scale_fill_manual(values=c("#A6CEE3", "#1F78B4"))
```

***Observation:***The Microbial P pool is \~4x larger than the available Soil P pool. The mechanism is confirmed.

## The Consequence: Stagnation

```{r}
# Graph 2: Stagnation
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
  stat_summary(fun=mean, geom="line", size=1) +
  stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
  labs(title="Effect: Biomass Stagnation", y="Wood Carbon (g/m2)") +
  scale_color_manual(values=c("black", "red")) + theme_bw()

# Stats
m_wood <- lmer(Wood_C ~ Trt * as.factor(Year) + (1|Ring), data=df)
stats_table(m_wood, "Wood Carbon ANOVA")
```

***Result:*** P \> 0.05 for Treatment. There is no significant increase in wood biomass. Replication successful.

**3. Extension Phase: The Adaptation** Are trees fighting back? We test two alternative hypotheses. \
**A. Foraging Strategy (Allocation)** \
Do trees invest more carbon into roots relative to wood to search for P?

```{r}
ggplot(df, aes(x=Year, y=Root_Shoot, color=Trt)) +
  stat_summary(fun=mean, geom="line", size=1) +
  stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
  labs(title="Adaptation 1: Root Foraging Investment", y="Root : Wood Ratio") +
  scale_color_manual(values=c("black", "red")) + theme_classic()
```

**B. Functional Efficiency (PUE)** \
Do trees gain more Carbon per gram of available P?

```{r}
df_clean <- df %>% filter(!is.na(GPP))
ggplot(df_clean, aes(x=Soil_P, y=GPP, color=Trt)) +
  geom_point(alpha=0.6) + 
  geom_smooth(method="lm", se=TRUE, fill="grey80") +
  labs(title="Adaptation 2: Physiological Efficiency", 
       subtitle="eCO2 (Red) maintains higher productivity at low P",
       x="Available Soil P", y="Carbon Uptake (GPP)") +
  scale_color_manual(values=c("black", "red")) + theme_classic()

# Stats for PUE
m_pue <- lmer(GPP ~ Soil_P * Trt + (1|Ring), data=df_clean)
kable(summary(m_pue)$coefficients, caption="Effect of Treatment on Efficiency")
```

## 4. Conclusion 

**1, Replication:** We confirmed Jiang et al.'s finding that microbial competition creates a P bottleneck, leading to biomass stagnation in wood.

**2. Novel Insight:** However, the ecosystem is not static. Our analysis reveals physiological adaptations. Trees under eCO2 shift allocation towards roots and significantly increase Phosphorus Use Efficiency, maintaining higher carbon uptake despite the rigorous soil limitation.
