labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork (if loaded) or gridExtra
# Since patchwork is in setup:
plot_a / plot_b + plot_layout(heights = c(2, 1))
# Results: Replication Phase
## The Phosphorus Inventory & Competition
# We compared the three main Phosphorus compartments: **Available Soil P**, **Microbial P**, and **Tree P Return** (Litter Flux).
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork (if loaded) or gridExtra
# Since patchwork is in setup:
plot_a / plot_b + plot_layout(heights = c(2, 1))
# Results: Replication Phase
## The Phosphorus Inventory & Competition
# We compared the three main Phosphorus compartments: **Available Soil P**, **Microbial P**, and **Tree P Return** (Litter Flux).
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016,2017,2018)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork (if loaded) or gridExtra
# Since patchwork is in setup:
plot_a / plot_b + plot_layout(heights = c(2, 1))
#| label: fig-wood
#| fig-cap: "Wood Biomass Trajectory."
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun=mean, geom="line", linewidth=1.2) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
scale_color_manual(name="Treatment", values=cols) +
scale_x_continuous(breaks=2013:2016) +
labs(y="Wood Carbon (g C / m²)")
#| label: fig-root
#| fig-cap: "Root:Wood Allocation Ratio. Faint lines indicate high spatial variability."
ggplot(df %>% filter(!is.na(Root_Shoot_Ratio)), aes(x = Year, y = Root_Shoot_Ratio, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.4, linewidth = 0.8) +
geom_point(aes(group = Ring), alpha = 0.4) +
stat_summary(aes(group = Trt), fun = mean, geom = "line",
linewidth = 1.5, linetype = "dashed") +
scale_color_manual(name="Treatment", values = cols) +
scale_x_continuous(breaks = 2013:2016) +
labs(y = "Root : Wood Ratio", x = "Year")
#| label: tbl-root
#| tbl-cap: "Statistical Analysis of Root Allocation."
lm_ring <- lm(Root_Shoot_Ratio ~ Ring + as.factor(Year), data = df)
print_stats(lm_ring, "ANOVA: Effect of Individual Rings on Allocation")
#| label: fig-wood
#| fig-cap: "Wood Biomass Trajectory. Despite elevated CO2, the red line (eCO2) does not diverge from the blue line (Ambient)."
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun=mean, geom="line", linewidth=1.2) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
scale_color_manual(name="Treatment", values=cols) +
scale_x_continuous(breaks=2013:2016) +
labs(y="Wood Carbon (g C / m²)")
View(df)
#| label: tbl-wood
#| tbl-cap: "ANOVA: Treatment Effect on Wood Biomass."
m_wood <- lmer(Wood_C ~ Trt * as.factor(Year) + (1|Ring), data=df)
print_stats(m_wood, "Model: Wood_C ~ Treatment * Year")
#| include: false
# --- PART 1: SETUP ---
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, lme4, lmerTest, knitr, kableExtra, here, broom.mixed, patchwork)
# Visualization Theme
theme_set(theme_classic(base_size = 12))
cols <- c("Ambient" = "#377EB8", "eCO2" = "#E41A1C")
# Helper: Map Rings to Treatments
get_trt <- function(ring) { ifelse(ring %in% c(1,4,5), "eCO2", "Ambient") }
# --- UPDATED ROBUST STATS FUNCTION ---
# This function handles both 'lmer' (NumDF) and 'lm' (Df) objects without errors
print_stats <- function(model, caption) {
# 1. Get ANOVA table safely
stats_df <- suppressWarnings(anova(model)) %>% as.data.frame()
# 2. Standardize Column Names (Handle both lm and lmer output differences)
if("F value" %in% names(stats_df)) stats_df <- rename(stats_df, `F-Statistic` = `F value`)
if("Pr(>F)" %in% names(stats_df))  stats_df <- rename(stats_df, `P-Value` = `Pr(>F)`)
stats_df %>%
# 3. Rounding (Use any_of to safely round columns only if they exist)
mutate(across(any_of(c("Sum Sq", "Mean Sq", "F-Statistic")), \(x) round(x, 2)),
across(any_of(c("NumDF", "Df")), \(x) round(x, 0)),
across(any_of("DenDF"), \(x) round(x, 1))) %>%
# 4. Format P-Values: Bold Red if < 0.05
mutate(
`P-Value` = cell_spec(
ifelse(`P-Value` < 0.001, "< 0.001", round(`P-Value`, 3)),
color = ifelse(!is.na(`P-Value`) & `P-Value` != "< 0.001" & as.numeric(`P-Value`) < 0.05, "red", "black"),
bold = ifelse(!is.na(`P-Value`) & `P-Value` != "< 0.001" & as.numeric(`P-Value`) < 0.05, TRUE, FALSE)
)
) %>%
kable(caption = caption, escape = FALSE) %>%
kable_styling(full_width = F, bootstrap_options = "striped") %>%
footnote(
general = "P-Value < 0.05 (Red) indicates a significant effect.",
general_title = "Legend: "
)
}
View(df)
View(gpp)
View(litter_list)
View(m_pool)
View(root_c)
View(wood_c)
View(root_c)
#| label: data-processing
# --- 1. ROBUST DATA LOADER ---
load_data <- function(filename, val_col_pattern, type = "pool") {
path <- here("EucFACE_P_Analysis/data", filename)
if(!file.exists(path)) path <- here("data", filename)
if(!file.exists(path)) return(NULL)
df <- read_csv(path, show_col_types = FALSE)
val_col <- names(df)[grepl(val_col_pattern, names(df), ignore.case = TRUE)][1]
clean_df <- df %>%
mutate(Date = parse_date_time(Date, orders = c("ymd", "dmy", "mdy")),
Year = year(Date)) %>%
filter(!is.na(Date)) %>%
rename(Value = all_of(val_col))
if (type == "pool") {
out <- clean_df %>% group_by(Year, Ring) %>% summarise(Val = mean(Value, na.rm=TRUE), .groups="drop")
} else if (type == "sum_depth") {
out <- clean_df %>%
filter(Depth %in% c("0_10", "10_30")) %>%
group_by(Date, Ring) %>% summarise(DailySum = sum(Value), .groups="drop") %>%
mutate(Year = year(Date)) %>%
group_by(Year, Ring) %>% summarise(Val = mean(DailySum, na.rm=TRUE), .groups="drop")
} else if (type == "flux") {
out <- clean_df %>% group_by(Year, Ring) %>% summarise(Val = mean(Value, na.rm=TRUE)*365/1000, .groups="drop")
}
return(out)
}
# --- 2. EXECUTE LOADING ---
soil_p  <- load_data("soil_phosphate_pool.csv", "phosphate", type="sum_depth") %>% rename(Soil_P = Val)
micro_p <- load_data("microbial_p_pool.csv", "microbial", type="sum_depth") %>% rename(Micro_P = Val)
wood_c  <- load_data("wood_c_pool.csv", "wood", type="pool") %>% rename(Wood_C = Val)
root_c  <- load_data("fineroot_c_pool.csv", "fineroot", type="pool") %>% rename(Root_C = Val)
gpp     <- load_data("overstorey_gpp_flux.csv", "GPP", type="pool") %>% rename(GPP = Val)
litter_files <- c("leaflitter_p_flux.csv", "twiglitter_p_flux.csv", "bark_litter_p_flux.csv", "seed_litter_p_flux.csv")
litter_list  <- lapply(litter_files, function(f) load_data(f, "flux|mg", type="flux"))
litter_p <- bind_rows(litter_list) %>%
group_by(Year, Ring) %>%
summarise(Total_P_Lost = sum(Val, na.rm=TRUE), .groups="drop")
# --- 3. MASTER MERGE ---
df_list <- list(wood_c, root_c, gpp, litter_p, soil_p, micro_p)
df <- df_list %>%
reduce(full_join, by = c("Year", "Ring")) %>%
mutate(Trt = get_trt(Ring), Ring = factor(Ring)) %>%
filter(Year >= 2013 & Year <= 2016) %>%
mutate(PUE = GPP / Total_P_Lost, Root_Shoot_Ratio = Root_C / Wood_C)
#| label: tbl-pools
#| tbl-cap: "ANOVA: Comparison of Ecosystem P Compartments."
m_pool <- lmer(Val ~ Type * Trt + (1|Ring), data = df_long_p)
print_stats(m_pool, "Model: Value ~ Compartment * Treatment")
#| label: fig-root
#| fig-cap: "Root:Wood Allocation Ratio. The high variability in the faint lines (individual rings) suggests that allocation strategies are driven more by local conditions than by the global CO2 treatment."
ggplot(df %>% filter(!is.na(Root_Shoot_Ratio)), aes(x = Year, y = Root_Shoot_Ratio, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.4, linewidth = 0.8) +
geom_point(aes(group = Ring), alpha = 0.4) +
stat_summary(aes(group = Trt), fun = mean, geom = "line",
linewidth = 1.5, linetype = "dashed") +
scale_color_manual(name="Treatment", values = cols) +
scale_x_continuous(breaks = 2013:2016) +
labs(y = "Root : Wood Ratio", x = "Year")
#| label: tbl-root
#| tbl-cap: "ANOVA: Effect of Individual Rings on Allocation."
lm_ring <- lm(Root_Shoot_Ratio ~ Ring + as.factor(Year), data = df)
print_stats(lm_ring, "ANOVA: Effect of Individual Rings on Allocation")
#| include: false
# --- PART 1: SETUP ---
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, lme4, lmerTest, knitr, kableExtra, here, broom.mixed, patchwork)
# Visualization Theme
theme_set(theme_classic(base_size = 12))
cols <- c("Ambient" = "#377EB8", "eCO2" = "#E41A1C")
# Helper: Map Rings to Treatments
get_trt <- function(ring) { ifelse(ring %in% c(1,4,5), "eCO2", "Ambient") }
# --- UPDATED & FIXED STATS FUNCTION ---
print_stats <- function(model, caption) {
# 1. Get ANOVA table safely
stats_df <- suppressWarnings(anova(model)) %>% as.data.frame()
# 2. Standardize Column Names
if("F value" %in% names(stats_df)) stats_df <- rename(stats_df, `F-Statistic` = `F value`)
if("Pr(>F)" %in% names(stats_df))  stats_df <- rename(stats_df, `P-Value` = `Pr(>F)`)
stats_df %>%
# 3. Round numeric columns
mutate(across(any_of(c("Sum Sq", "Mean Sq", "F-Statistic")), \(x) round(x, 2)),
across(any_of(c("NumDF", "Df")), \(x) round(x, 0)),
across(any_of("DenDF"), \(x) round(x, 1))) %>%
# 4. robust P-value formatting (Text-based to prevent HTML errors)
mutate(
`Sig` = ifelse(!is.na(`P-Value`) & `P-Value` < 0.05, "*", ""), # Add Star for significance
`P-Value` = ifelse(`P-Value` < 0.001, "< 0.001", sprintf("%.3f", `P-Value`))
) %>%
# 5. Create Table
kable(caption = caption, align = "r") %>%
kable_styling(full_width = F, bootstrap_options = "striped") %>%
footnote(
general = "* Indicates statistical significance (P < 0.05).",
general_title = "Note: "
)
}
#| include: false
# --- PART 1: SETUP ---
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, lme4, lmerTest, knitr, kableExtra, here, broom.mixed, patchwork)
# Visualization Theme
theme_set(theme_classic(base_size = 12))
cols <- c("Ambient" = "#377EB8", "eCO2" = "#E41A1C")
# Helper: Map Rings to Treatments
get_trt <- function(ring) { ifelse(ring %in% c(1,4,5), "eCO2", "Ambient") }
# --- UPDATED & FIXED STATS FUNCTION ---
print_stats <- function(model, caption) {
# 1. Get ANOVA table safely
stats_df <- suppressWarnings(anova(model)) %>% as.data.frame()
# 2. Standardize Column Names
if("F value" %in% names(stats_df)) stats_df <- rename(stats_df, `F-Statistic` = `F value`)
if("Pr(>F)" %in% names(stats_df))  stats_df <- rename(stats_df, `P-Value` = `Pr(>F)`)
stats_df %>%
# 3. Round numeric columns
mutate(across(any_of(c("Sum Sq", "Mean Sq", "F-Statistic")), \(x) round(x, 2)),
across(any_of(c("NumDF", "Df")), \(x) round(x, 0)),
across(any_of("DenDF"), \(x) round(x, 1))) %>%
# 4. robust P-value formatting (Text-based to prevent HTML errors)
mutate(
`Sig` = ifelse(!is.na(`P-Value`) & `P-Value` < 0.05, "*", ""), # Add Star for significance
`P-Value` = ifelse(`P-Value` < 0.001, "< 0.001", sprintf("%.3f", `P-Value`))
) %>%
# 5. Create Table
kable(caption = caption, align = "r") %>%
kable_styling(full_width = F, bootstrap_options = "striped") %>%
footnote(
general = "* Indicates statistical significance (P < 0.05).",
general_title = "Note: "
)
}
#| label: tbl-wood
#| tbl-cap: "ANOVA: Treatment Effect on Wood Biomass."
m_wood <- lmer(Wood_C ~ Trt * as.factor(Year) + (1|Ring), data=df)
print_stats(m_wood, "ANOVA: Treatment Effect on Wood Biomass")
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
plot_a / plot_b + plot_layout(heights = c(2, 1))
# Export the graphs for presentation
ggsave(here("output", "Fig1_Phosphorus_Budget.png"),
plot = combined_plot, width = 10, height = 7, dpi = 300)
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
plot_a / plot_b + plot_layout(heights = c(2, 1))
print(combined_plot)
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
combined_plot <- plot_a / plot_b + plot_layout(heights = c(2, 1))
print(combined_plot)
# Export the graphs for presentation
ggsave(here("output", "Fig1_Phosphorus_Budget.png"),
plot = combined_plot, width = 10, height = 7, dpi = 300)
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
combined_plot <- plot_a / plot_b + plot_layout(heights = c(2, 1))
# Export the graphs for presentation
ggsave(here("output", "Fig1_Phosphorus_Budget.png"),
plot = combined_plot, width = 10, height = 7, dpi = 300)
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
combined_plot <- plot_a / plot_b + plot_layout(heights = c(2, 1))
print(combined_plot)
# Export the graphs for presentation
ggsave(here("output", "Fig1_Phosphorus_Budget.png"),
plot = combined_plot, width = 10, height = 7, dpi = 300)
#| label: fig-wood
#| fig-cap: "Wood Biomass Trajectory. Despite elevated CO2, the red line (eCO2) does not diverge from the blue line (Ambient)."
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun=mean, geom="line", linewidth=1.2) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
scale_color_manual(name="Treatment", values=cols) +
scale_x_continuous(breaks=2013:2016) +
labs(y="Wood Carbon (g C / m²)")
ggsave(here("output", "Fig2_Biomass_Stagnation.png"),
width = 8, height = 5, dpi = 300)
#| label: tbl-root
#| tbl-cap: "ANOVA: Effect of Individual Rings on Allocation."
lm_ring <- lm(Root_Shoot_Ratio ~ Ring + as.factor(Year), data = df)
print_stats(lm_ring, "ANOVA: Effect of Individual Rings on Allocation")
#| label: fig-pue
#| fig-cap: "Functional Plasticity (PUE). eCO2 trees trend towards higher productivity per unit Soil P."
df_flux <- df %>% filter(!is.na(PUE) & !is.na(Soil_P))
ggplot(df_flux, aes(x=Soil_P, y=GPP, color=Trt, fill=Trt)) +
geom_point(size=3, alpha=0.6, shape=21, color="white") +
geom_smooth(method="lm", alpha=0.2) +
scale_color_manual(name="Treatment", values=cols) +
scale_fill_manual(name="Treatment", values=cols) +
labs(x="Available Soil Phosphorus (g/m²)", y="Carbon Uptake (GPP)")
# Export the graph for presentation
ggsave(here("output", "Fig4_Functional_Efficiency.png"),
width = 8, height = 5, dpi = 300)
#| label: tbl-pue
#| tbl-cap: "ANOVA: PUE Interaction (Soil P x Treatment)."
m_pue <- lmer(GPP ~ Soil_P * Trt + (1|Ring), data=df_flux)
print_stats(m_pue, "ANOVA: PUE Interaction")
