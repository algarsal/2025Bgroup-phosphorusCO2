#| include: false
#| warning: false
#| message: false
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(lme4)
library(lmerTest)
library(patchwork)
library(knitr)
library(kableExtra)
# Helper function
stats_table <- function(model, title) {
res <- anova(model)
kable(res, caption=title, digits=3) %>% kable_styling(full_width=F)
}
df <- read_csv("data/master_data.csv")
# A. Inventory
pool_stats <- df %>% group_by(Trt) %>%
summarise(Micro=mean(Micro_P, na.rm=T), Soil=mean(Soil_P, na.rm=T))
# Graph 1: The Microbial Lockout
df %>% pivot_longer(c(Soil_P, Micro_P), names_to="Pool", values_to="Val") %>%
ggplot(aes(x=Pool, y=Val, fill=Trt)) +
stat_summary(fun=mean, geom="bar", position="dodge") +
stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(0.9), width=0.2) +
labs(title="Mechanism: Microbial Pre-emption", y="g P / m2") +
theme_classic() + scale_fill_manual(values=c("#A6CEE3", "#1F78B4"))
# Graph 2: Stagnation
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
stat_summary(fun=mean, geom="line", size=1) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
labs(title="Effect: Biomass Stagnation", y="Wood Carbon (g/m2)") +
scale_color_manual(values=c("black", "red")) + theme_bw()
# Stats
m_wood <- lmer(Wood_C ~ Trt * as.factor(Year) + (1|Ring), data=df)
stats_table(m_wood, "Wood Carbon ANOVA")
ggplot(df, aes(x=Year, y=Root_Shoot, color=Trt)) +
stat_summary(fun=mean, geom="line", size=1) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
labs(title="Adaptation 1: Root Foraging Investment", y="Root : Wood Ratio") +
scale_color_manual(values=c("black", "red")) + theme_classic()
df_clean <- df %>% filter(!is.na(GPP))
ggplot(df_clean, aes(x=Soil_P, y=GPP, color=Trt)) +
geom_point(alpha=0.6) +
geom_smooth(method="lm", se=TRUE, fill="grey80") +
labs(title="Adaptation 2: Physiological Efficiency",
subtitle="eCO2 (Red) maintains higher productivity at low P",
x="Available Soil P", y="Carbon Uptake (GPP)") +
scale_color_manual(values=c("black", "red")) + theme_classic()
# Stats for PUE
m_pue <- lmer(GPP ~ Soil_P * Trt + (1|Ring), data=df_clean)
kable(summary(m_pue)$coefficients, caption="Effect of Treatment on Efficiency")
---
title: "Microbial Competition & Tree Adaptations"
#| include: false
#| warning: false
#| message: false
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(lme4)
library(lmerTest)
library(patchwork)
library(knitr)
library(kableExtra)
# Helper function
stats_table <- function(model, title) {
res <- anova(model)
kable(res, caption=title, digits=3) %>% kable_styling(full_width=F)
}
df <- read_csv("EucFACE_P_Analysis/data/master_data.csv")
# A. Inventory
pool_stats <- df %>% group_by(Trt) %>%
summarise(Micro=mean(Micro_P, na.rm=T), Soil=mean(Soil_P, na.rm=T))
# Graph 1: The Microbial Lockout
df %>% pivot_longer(c(Soil_P, Micro_P), names_to="Pool", values_to="Val") %>%
ggplot(aes(x=Pool, y=Val, fill=Trt)) +
stat_summary(fun=mean, geom="bar", position="dodge") +
stat_summary(fun.data=mean_se, geom="errorbar", position=position_dodge(0.9), width=0.2) +
labs(title="Mechanism: Microbial Pre-emption", y="g P / m2") +
theme_classic() + scale_fill_manual(values=c("#A6CEE3", "#1F78B4"))
# Graph 2: Stagnation
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
stat_summary(fun=mean, geom="line", size=1) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
labs(title="Effect: Biomass Stagnation", y="Wood Carbon (g/m2)") +
scale_color_manual(values=c("black", "red")) + theme_bw()
# Stats
m_wood <- lmer(Wood_C ~ Trt * as.factor(Year) + (1|Ring), data=df)
stats_table(m_wood, "Wood Carbon ANOVA")
ggplot(df, aes(x=Year, y=Root_Shoot, color=Trt)) +
stat_summary(fun=mean, geom="line", size=1) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
labs(title="Adaptation 1: Root Foraging Investment", y="Root : Wood Ratio") +
scale_color_manual(values=c("black", "red")) + theme_classic()
df_clean <- df %>% filter(!is.na(GPP))
ggplot(df_clean, aes(x=Soil_P, y=GPP, color=Trt)) +
geom_point(alpha=0.6) +
geom_smooth(method="lm", se=TRUE, fill="grey80") +
labs(title="Adaptation 2: Physiological Efficiency",
subtitle="eCO2 (Red) maintains higher productivity at low P",
x="Available Soil P", y="Carbon Uptake (GPP)") +
scale_color_manual(values=c("black", "red")) + theme_classic()
# Stats for PUE
m_pue <- lmer(GPP ~ Soil_P * Trt + (1|Ring), data=df_clean)
kable(summary(m_pue)$coefficients, caption="Effect of Treatment on Efficiency")
#| include: false
# --- PART 1A: SETUP THE LIBRARY ---
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, lme4, lmerTest, knitr, kableExtra, here, broom.mixed, patchwork)
#| label: fig-wood
#| fig-cap: "Wood Biomass Trajectory. Despite elevated CO2, the red line (eCO2) does not diverge from the blue line (Ambient)."
ggplot(df, aes(x=Year, y=Wood_C, color=Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun=mean, geom="line", linewidth=1.2) +
stat_summary(fun.data=mean_se, geom="errorbar", width=0.1) +
scale_color_manual(name="Treatment", values=cols) +
scale_x_continuous(breaks=2013:2016) +
labs(y="Wood Carbon (g C / m²)")
rlang::last_trace()
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
combined_plot <- plot_a / plot_b + plot_layout(heights = c(2, 1))
print(combined_plot)
#| label: fig-pools
#| fig-cap: "The Ecosystem Phosphorus Budget. (A) Time series of P pools. Note that the Microbial pool (Middle) is ~10x larger than the Soil pool (Left) or Tree Return (Right). (B) The negative relationship between Microbes and Soil P suggests active drawdown."
# --- 1. PREPARE DATA ---
# We add "Total_P_Lost" (Litter) as a proxy for Tree P cycling
df_long_p <- df %>%
select(Year, Ring, Trt, Soil_P, Micro_P, Total_P_Lost) %>%
pivot_longer(cols = c(Soil_P, Micro_P, Total_P_Lost), names_to = "Type", values_to = "Val") %>%
mutate(Type = recode(Type,
"Soil_P" = "1. Available Soil P",
"Micro_P" = "2. Microbial P (Lockout)",
"Total_P_Lost" = "3. Tree P Return (Litter)")) %>%
drop_na(Val)
# --- 2. PLOT A: TIME SERIES ---
plot_a <- ggplot(df_long_p, aes(x = Year, y = Val, color = Trt)) +
geom_line(aes(group = Ring), alpha = 0.3, linewidth = 0.6) +
stat_summary(fun = mean, geom = "line", linewidth = 1.2) +
stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.1) +
facet_wrap(~Type, scales = "free_y", nrow = 1) +
scale_color_manual(name = "Treatment", values = cols) +
scale_x_continuous(breaks = c(2013, 2014, 2015, 2016)) +
labs(y = "Phosphorus (g P / m²)", x = NULL, title = "A. Magnitude of P Pools") +
theme(legend.position = "top",
strip.background = element_rect(fill = "#f0f0f0", color = NA),
strip.text = element_text(face = "bold", size = 10))
# --- 3. PLOT B: CORRELATION (RELATION) ---
# Is there a trade-off? As Microbes go UP, does Soil P go DOWN?
plot_b <- ggplot(df, aes(x = Micro_P, y = Soil_P, color = Trt)) +
geom_point(alpha = 0.6, size = 2) +
geom_smooth(method = "lm", se = TRUE, alpha = 0.2) +
scale_color_manual(name = "Treatment", values = cols) +
labs(y = "Available Soil P", x = "Microbial P", title = "B. Microbial Drawdown") +
theme(legend.position = "none")
# Combine plots using patchwork
combined_plot <- plot_a / plot_b + plot_layout(heights = c(2, 1))
print(combined_plot)
setwd(Preliminary-results-presented)
setwd("Preliminary-results-presented")
# --- PART 1B:
setwd(Preliminary-results-presented)
load("~/GitHub/2025Bgroup-phosphorusCO2/.RData")
load("~/GitHub/2025Bgroup-phosphorusCO2/.RData")
